name: Daily Research Update

on:
  # TÃ¤glich um 7:00 Uhr MEZ (6:00 UTC im Winter, 5:00 UTC im Sommer)
  schedule:
    - cron: '0 6 * * *'  # 6:00 UTC = 7:00 MEZ (Winterzeit)

  # Manueller Trigger fÃ¼r Tests
  workflow_dispatch:

jobs:
  research:
    runs-on: ubuntu-latest

    permissions:
      contents: write  # BenÃ¶tigt um Ã„nderungen zu committen

    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: ðŸ“¦ Install Dependencies
        run: |
          pip install --upgrade pip
          pip install -r scripts/requirements.txt

      - name: ðŸ” Run Research Script
        env:
          # Optional: API-Keys als GitHub Secrets hinterlegen
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
        run: |
          echo "Starting Galileo Research Tool..."
          python scripts/main_research.py

      - name: ðŸ“Š Check for Changes
        id: check_changes
        run: |
          if git diff --quiet docs/data/topics.json; then
            echo "changed=false" >> $GITHUB_OUTPUT
            echo "No changes detected"
          else
            echo "changed=true" >> $GITHUB_OUTPUT
            echo "Changes detected in topics.json"
          fi

      - name: ðŸ’¾ Commit and Push Changes
        if: steps.check_changes.outputs.changed == 'true'
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "GitHub Actions Bot"

          git add docs/data/topics.json

          git commit -m "$(cat <<'EOF'
          ðŸ¤– Automatisches Recherche-Update

          TÃ¤gliche automatische Aktualisierung der ThemenvorschlÃ¤ge
          DurchgefÃ¼hrt am $(date +'%d.%m.%Y um %H:%M Uhr')
          EOF
          )"

          git push

      - name: âœ… Success Notification
        if: success()
        run: |
          echo "âœ… Research update completed successfully!"
          echo "ðŸ“… Date: $(date +'%d.%m.%Y %H:%M:%S')"

      - name: âŒ Failure Notification
        if: failure()
        run: |
          echo "âŒ Research update failed!"
          echo "Please check the logs for details."
